(function(a){function g(d){if(typeof d.data==="string"){var b=d.handler,f=d.data.toLowerCase().split(" ");d.handler=function(c){if(!(this!==c.target&&(/textarea|select/i.test(c.target.nodeName)||c.target.type==="text"))){var e=c.type!=="keypress"&&a.hotkeys.specialKeys[c.which],h=String.fromCharCode(c.which).toLowerCase(),i="",j={};if(c.altKey&&e!=="alt")i+="alt+";if(c.ctrlKey&&e!=="ctrl")i+="ctrl+";if(c.metaKey&&!c.ctrlKey&&e!=="meta")i+="meta+";if(c.shiftKey&&e!=="shift")i+="shift+";if(e)j[i+e]=
true;else{j[i+h]=true;j[i+a.hotkeys.shiftNums[h]]=true;if(i==="shift+")j[a.hotkeys.shiftNums[h]]=true}e=0;for(h=f.length;e<h;e++)if(j[f[e]])return b.apply(this,arguments)}}}}a.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",
106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};a.each(["keydown","keyup","keypress"],function(){a.event.special[this]={add:g}})})(jQuery);
if(!window.console)window.console={log:function(){},warn:function(){},error:function(){},fatal:function(){},debug:function(){},dir:function(){}};
(function(a){var g={debug:false,baseUrl:"",options:{autoLoad:true},modules:{},url:function(d){return this.baseUrl+d},extend:function(d,b,f){if(typeof this.modules[d]==="undefined"){var c=a.extend({},this.options,f);switch(typeof b){case "object":this[d]=b;break;case "function":if(c.autoLoad)this.loadModule(b,f);else this.modules[d]={origin:b,load:false};break;default:return}}},loadModule:function(d,b){var f;if(typeof d=="function")f=d;else if(typeof d=="string"){d=this.modules[d];if(typeof d!=="undefined"){f=
d.origin;d.load=true}else return}f.call(this,this,b)},include:function(d){if(!(d==null||typeof d!="string")){var b=document.createElement("script");b.type="text/javascript";b.charset="utf-8";b.src=d;a.ajaxSetup({cache:true});a("head").append(b)}},loadCSS:function(d){if(!(d==null||typeof d!="string")){var b=top.document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=d;a.ajaxSetup({cache:true});a("head").append(b)}},destroy:function(){}};window.Ediary=g;g.extend("i18n",function(d){d.i18n=
{languages:{},extend:function(b,f){if(typeof this.languages[b]=="undefined")this.languages[b]=f;return f},get:function(b){if(typeof this.languages[b]!=="undefined")return this.languages[b]}}});g.extend("Date",function(d){d.Date={dayNames:["\u661f\u671f\u5929","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],dayNamesMin:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],monthNames:["\u4e00\u6708","\u4e8c\u6708",
"\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],init:function(){},getDateAndWeek:function(b){b=b||new Date;return b.getFullYear()+"\u5e74"+(b.getMonth()+1)+"\u6708"+b.getDate()+"\u65e5 "+this.dayNames[b.getDay()]},sqlDateFormator:function(b){b=b||new Date;if(jQuery.datepicker)return a.datepicker.formatDate("yy-mm-dd",b)}}})})(jQuery);
(function(){Ediary.extend("Events",function(a){var g=function(){this.listeners={}};g.prototype={addListener:function(b,f){if(typeof this.listeners[b]=="undefined")this.listeners[b]=[];this.listeners[b].push(f)},callListener:function(b,f){if(b=this.listeners[b])for(var c in b)b[c].handleEvent(f)},prepareArguments:function(){}};var d=function(b){this.handler=b};d.prototype={handleEvent:function(b){this.handler.apply(this,b)},makeArgs:function(){}};a.Events=g;a.Listener=d})})(jQuery,Ediary,window);
(function(a,g){var d={data:{count:10,page:1},options:{element:"#editor-btn-open",tableElem:"#table_diary_list",tbodyElem:"#table_diary_list>tbody",editBtnElem:"#table_diary_list .icon_edit_16",delBtnElem:"#table_diary_list .icon_del_16",filterElem:"#diarys_list_filter",startDateElem:"#datepicker-start",endDateElem:"#datepicker-end",boxElem:"#toolbar_extBox_list",tabsElem:"#editor-toolbar",flashElem:"#diarys_list_flash",pageElem:"#diarys_list_pages",nextPageElem:"#diarys_list_next_page",prePageElem:"#diarys_list_pre_page",
listUrl:g.url("/diary/list/get"),getUserDiaryUrl:g.url("/diary/do/user_diarys"),delUrl:g.url("/diary/do/delete")},isReady:false,init:function(){if(this.isReady)return this;this.isReady=true;a.extend(this.options,this.extData);this.element=a(this.options.element);this.bindEvent();this.flash();return this},flash:function(){this.doGetDiarys(this.data)},bindEvent:function(){var b=this,f=this.options;a(f.flashElem).click(function(){b.doGetDiarys(a.extend(b.data,{page:a(f.tableElem).data("last").current_page||
1}));return false});a(f.editBtnElem).live("click",function(){var e=b._findId(this);if(e){g.Editor.doGetDiary(e);a(f.tabsElem).simpleTabs("hide")}return false});a(f.delBtnElem).live("click",function(){var e=this;b.doDelete(b._findId(this),function(){a(e).parent().parent().hide()});return false});a(f.nextPageElem).click(function(){var e=b._nextPage();e&&b.doGetDiarys(a.extend(b.data,{page:e}));return false});a(f.prePageElem).click(function(){var e=b._nextPage(true);e&&b.doGetDiarys(a.extend(b.data,
{page:e}));return false});a(f.filterElem).click(function(){var e=a(f.startDateElem).val(),h=a(f.endDateElem).val(),i=new Date,j={page:1,count:b.data.count};if(e)j.since=e;j.max=h?h:i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate();if(j.since&&j.max&&Date.parse(j.since)>Date.parse(j.max)){g.Notice.showDialog("\u8d77\u59cb\u65e5\u671f\u4e0d\u5f97\u5927\u4e8e\u7ed3\u675f\u65e5\u671f.","\u8b66\u544a");return false}b.doGetDiarys(j);b.data=j;return false});var c={dateFormat:"yy-mm-dd",dayNamesMin:g.Date.dayNamesMin,
monthNames:g.Date.monthNames};a("#datepicker-start").datepicker(c);a("#datepicker-end").datepicker(c)},_nextPage:function(b){var f=this.options;b=b||false;if(f=a(f.tableElem).data("last"))if(b){if(f.current_page!==1)return parseInt(f.current_page)-1}else if(f.current_page*this.data.count<f.total_diarys)return parseInt(f.current_page)+1;return false},_findId:function(b){$tr=a(b).parent().parent();if($tr.length>0)return parseInt($tr.attr("id").replace("diarys_item_id_",""))},doDelete:function(b,f){a.ajax({url:this.options.delUrl,
type:"post",data:{id:b},dataType:"json",success:function(c){c&&c.result&&f();g.Notice.showMessage("\u6210\u529f",1E3)}})},doGetDiarys:function(b){var f=this,c=this.options,e=b||{count:10,page:1};a(c.tableElem).data("last",{});a.ajax({url:c.getUserDiaryUrl,type:"post",dataType:"json",data:e,beforeSendMessage:"\u6b63\u5728\u8bf7\u6c42\u670d\u52a1\u5668",success:function(h){if(h&&h.diarys){f.updateTable(h,e);g.Notice.showMessage("\u6210\u529f",1E3);delete h.diarys;a(c.tableElem).data("last",h)}}})},
updateTable:function(b,f){var c=this.options,e=a(c.tbodyElem).empty(),h=a(c.pageElem).empty(),i=b.diarys;for(var j in i){var k=i[j],l="<td>"+k.title+"</td><td>"+k.content+"</td><td>"+k.saved_at+'</td><td><a class="icon_edit_16" href="/diary/'+k.id+'"></a><td><a class="icon_del_16" href="/diary/del/'+k.id+'"></a>';a("<tr></tr>").attr("id","diarys_item_id_"+k.id).html(l).appendTo(e)}0==i.length&&e.html("<tr><td>\u65e0\u65e5\u8bb0</td></tr>");f=b.current_page*f.count-f.count+1;h.html(f+" - "+(f+i.length-
1)+" of "+b.total_diarys);this.data.since&&a(c.startDateElem).val(this.data.since);this.data.max&&a(c.endDateElem).val(this.data.max)},getList:function(b){var f=this.options;b=b||1;a.ajax({url:f.listUrl,type:"post",dataType:"html",data:{page:b},success:function(c){a(f.boxElem).html(c);g.Notice.showMessage("\u6210\u529f",1E3)}})},destroy:function(){}};g.DiarysManager=d})(jQuery,Ediary,window);
(function(a,g,d){var b={SAVE_SUCCESS:"\u4fdd\u5b58\u6210\u529f.",SAVE_FAIL:"\u4fdd\u5b58\u5931\u8d25.",SAVING:"\u6b63\u5728\u4fdd\u5b58...",JSON_PARSE_ERROR:"\u65e0\u6cd5\u89e3\u6790\u670d\u52a1\u5668\u8fd4\u56de\u7684\u6570\u636e",NOT_SAVED:"\u65e5\u8bb0\u6ca1\u6709\u4fdd\u5b58, \u786e\u5b9a\u79bb\u5f00?",GETING_DIARYS:"\u6b63\u5728\u83b7\u53d6\u65e5\u8bb0.",SUCCESS:"\u6210\u529f"};g.i18n.extend("Editor",b);var f={TAG:"Editor -> ",AUTO_SAVE_INTERVAL:3E4,isReady:false,element:null,titleElem:null,
bodyElem:null,resizer:null,updater:null,isSaving:false,titleLength:-1,contentLength:-1,settings:{element:"#diary",formElem:"#form_diary",titleElem:"#diary_title",idElem:"#diary_id",bodyElem:"#diary_content",mceElemId:"diary_content",mceWidth:"572",containerElem:".diary_container",updateElem:"#diary_last_update",ajaxSetup:{},saveUrl:Ediary.baseUrl+"/diary/do/save",getDiaryUrl:g.url("/diary/do/get"),deleteUrl:""},events:new Ediary.Events,init:function(c){var e=this;c=a.extend(this.settings,c);if(this.checkDOMIsReady()){this.element=
a(c.element);this.bodyElem=a(c.bodyElem);this.titleElem=a(c.titleElem);this.containerElem=a(c.containerElem);this.setupTinyMCE();this.setupAjax();this.updateTitleContentLength();this.cache("diary",this.getValues());this.bindEvent();if(!this.isReadonly()){this.resizer=setInterval(function(){e.resize()},500);this.startAutoSave(true)}this.isReady=true;return this}},bindEvent:function(){var c=this;this.titleElem.bind("change",function(){c.doSave(true)});a(d).bind("beforeunload",function(){c.rteSave(true);
if(c.isChanged())return b.NOT_SAVED})},updateTitleContentLength:function(){this.titleLength=this.titleElem.val().length;this.contentLength=this.bodyElem.val().length},setupTinyMCE:function(){d.tinyMCE.init({mode:"exact",elements:this.settings.mceElemId,auto_focus:this.settings.mceElemId,readonly:this.isReadonly()?1:0,width:this.settings.mceWidth,height:this.bodyElem.height(),plugins:"inlinepopups",theme:"advanced",skin:"default",content_css:g.baseUrl+"/css/rte.css",theme_advanced_buttons1:"bold,italic,underline,forecolor,|,justifyleft,justifycenter,justifyright,|,indent,outdent,|,strikethrough,|,bullist,numlist,|,link,removeformat",
theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"docked",theme_penzu_toolbar_location_docked_element_id:"diary_editor_toolbar_docked",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"none",theme_advanced_resizing:true,invalid_elements:"embed,object,script,form",entity_encoding:"raw",paste_convert_middot_lists:true,paste_remove_spans:true,paste_remove_styles:true,paste_strip_class_attributes:true,nonbreaking_force_tab:true,convert_urls:false,
setup:function(c){a.browser.msie&&c.onPostRender.add(function(e){if(a.browser.msie){a("iframe",a(e.getContentAreaContainer())).attr("allowTransparency","true");a(e.getBody()).css("background","transparent")}})}})},setDefaultContent:function(){},checkDOMIsReady:function(){var c=this.settings,e=["element","titleElem","bodyElem","containerElem","formElem"];for(var h in e){h=e[h];if(a(c[h]).length<1)return false}return true},addListener:function(c,e){e=new g.Listener(e);this.events.addListener(c,e)},
hook:function(c,e){this.events.callListener(c,e)},callback:function(c){typeof this[c]==="function"&&this[c].call(this)},isReadonly:function(){return this.titleElem.attr("readonly")||this.bodyElem.attr("readonly")},getRTEditor:function(){var c=null;try{c=d.tinyMCE.get(this.bodyElem.attr("id"))}catch(e){}return c},repaint:function(c){c=c||this.getCache("diary");typeof c.title!=="undefined"&&this.setTitle(c.title);typeof c.content!=="undefined"&&this.setContent(c.content);typeof c.id!=="undefined"&&
this.setId(c.id);typeof c.saved_at!=="undefined"&&a(this.settings.updateElem).html(c.saved_at);this.setDefaultContent()},newDiary:function(){this.repaint({title:g.Date.getDateAndWeek(),content:"",id:"-1",saved_at:"\u672a\u4fdd\u5b58"})},getValues:function(){return{title:this.getTitle(),content:this.getContent(),id:this.getId(),saved_at:a(this.settings.updateElem).html()}},updateId:function(){this.setId(this.getCache("diary").id)},isEmpty:function(){return 0===this.titleElem.val().length||0===this.bodyElem.val().length},
isChanged:function(){return this.titleElem.val().length!==this.titleLength||this.bodyElem.val().length!==this.contentLength},startAutoSave:function(){var c=this;this.updater=setInterval(function(){c.doSave()},c.AUTO_SAVE_INTERVAL)},stopAutoSave:function(){if(this.updater){clearInterval(this.updater);this.updater=null}},resize:function(){var c=this.getRTEditor(),e,h,i,j,k={minHeight:815,increment:815,margin:0};if(c){e=a("iframe",a(c.getContentAreaContainer()));h=e.height();i=a(c.getBody()).children().length*
24;k.margin=40}else if(!this.isReadonly()){e=this.bodyElem;h=e.height();i=a(e.get(0)).scrollTop()}if(e){if(h<i+k.margin||h-k.increment>i+k.margin)j=Math.ceil((i+k.margin)/k.increment)*k.increment;if(j){j=Math.max(k.minHeight,j);e.css("height",j+"px");this.containerElem.css("height",j+"px")}}},stopResizer:function(){if(this.resizer){clearInterval(this.resizer);this.resizer=null}},rteSave:function(c){c=c||false;var e=this.getRTEditor();if(c||e&&e.isDirty())e.save()},doSave:function(c){if(!this.isSaving)try{var e=
this;c=c||false;var h=a(this.settings.formElem);this.rteSave();if(this.isEmpty())g.Notice.showMessage("\u65e5\u8bb0\u4e3a\u7a7a, \u5199\u70b9\u4e1c\u897f\u5148\u5427.",1E3);else if(c||this.isChanged())a.ajax({url:e.settings.saveUrl,type:"POST",data:h.serialize(),dataType:"json",beforeSend:function(){e.isSaving=true;g.Notice.showMessage(b.SAVING);e.updateStatus(false);e.hook("onBeforeSend",arguments)},success:function(j){e.isSaving=false;e.onSaveDone(j);e.updateStatus(true);e.hook("onSaveDone",arguments)}})}catch(i){}},
onSaveDone:function(c){var e=b.SAVE_FAIL;if(this.checkData(c)&&c.diary){this.repaint({saved_at:c.diary.saved_at});this.updateTitleContentLength();e=b.SAVE_SUCCESS;c.diary.created_date==g.Date.sqlDateFormator(new Date)&&g.Tooltip.unCheck()}g.Notice.showMessage(e,3E3)},updateStatus:function(c){c=c||false;var e=a(this.settings.updateElem).prev();if(c){e.removeClass("icon_loading_16");e.addClass("icon_ok_16")}else{e.removeClass("icon_ok_16");e.addClass("icon_loading_16")}},checkData:function(c){if(null==
c)return false;if(c.error){g.Notice.showMessage(c.error);return false}c.diary&&this.cache("diary",c.diary);c.callback&&this.callback(c.callback);return true},doGetDiary:function(c){var e=this;a.ajax({url:e.settings.getDiaryUrl,data:{id:c},type:"POST",dataType:"json",beforeSendMessage:b.GET_DIARYS,success:function(h){e.onGetDiaryDone(h);e.hook("onGetDiaryDone",arguments)}})},onGetDiaryDone:function(c){if(this.checkData(c))if(c.diary){this.repaint();g.Notice.showMessage(b.SUCCESS,1E3)}},doDelete:function(){},
setupAjax:function(){var c=this;a.extend(this.settings.ajaxSetup,{error:function(e,h){"parsererror"==h&&g.Notice.showMessage(b.JSON_PARSE_ERROR);c.hook("onError",arguments)},beforeSend:function(e,h){var i=h.beforeSendMessage;i&&g.Notice.showMessage(i);c.hook("onBeforeSend",arguments)}});a.ajaxSetup(this.settings.ajaxSetup)},cache:function(c,e){this.element.data(c,e)},getCache:function(c){return this.element.data(c)},setTitle:function(c){this.titleElem.val(c)},getTitle:function(){return this.titleElem.val()},
setContent:function(c){this.getRTEditor()?this.getRTEditor().setContent(c):this.bodyElem.val(c)},getContent:function(){return this.getRTEditor()?this.getRTEditor().getContent():this.bodyElem.val()},setId:function(c){a(this.settings.idElem).val(c)},getId:function(){return a(this.settings.idElem).val()},destroy:function(){this.stopAutoSave();this.stopResizer();this.getRTEditor();this.bodyElem=this.titleElem=this.element=null}};g.extend("Editor",f)})(jQuery,Ediary,window);
(function(a){var g={element:null,isReady:false,options:{element:"#notice",dialogElem:"#dialog-message"},dialog:null,timer:null,init:function(d){if(!this.isReady){a.extend(this.options,d);this.element=a(this.options.element);if(this.element.length!=0){this.isReady=true;return this}}},showMessage:function(d,b){this.isReady||this.init();this._setMessage(d);typeof b!=="undefined"&&this._hide(b);return this},getMessage:function(){if(this.element)return this.element.html()},showDialog:function(d,b){var f=
this.options;b=b||"\u63d0\u793a\u6846";if(!this.dialog){this.dialog=a(f.dialogElem);if(this.dialog.length==0)this.dialog=a("<div></div>").attr("id",f.dialogElem.slice(1)).attr("title",b).appendTo(a("body"));this.dialog.dialog({modal:true,buttons:{Ok:function(){a(this).dialog("close")}}})}this.dialog.attr("title",b).text(d).dialog("open")},_setMessage:function(d){this.timer&&clearTimeout(this.timer);this.element.show();this.element.html(d)},_resetMessage:function(){this._setMessage("")},_hide:function(d){var b=
this;this.timer=setTimeout(function(){b._resetMessage();b.element.hide()},d)},destroy:function(){this._resetMessage();this.element=null}};Ediary.extend("Notice",g);g=a.extend({},g,{OK:"ok",ERR:"error",options:{element:"#gTips"},_setMessage:function(d){this.timer&&clearTimeout(this.timer);this.element.show();this.getTextElement().html(d)},setType:function(d){this.element.removeClass().addClass(d)},getType:function(){this.element.attr("class")},getTextElement:function(){return this.element.children("span")},
check:function(){this.getTextElement().text()!=""&&this.element.show().data("today",false)},unCheck:function(){false===this.element.data("today")&&this.showMessage("",0)}});Ediary.extend("Tooltip",g)})(jQuery,Ediary,window);
(function(a,g){g.extend("Pad",{options:{editor:{},notice:{}},init:function(d){g.Tooltip.init().check();this.initEditor(d);return this},initEditor:function(d){a.extend(this.options,d);var b=g.Editor.init(this.options.editor);b.addListener("onSaveSuccess",function(){});a("#editor-toolbar").simpleTabs({select:null,useId:true,cache:true,noCache:["editor-btn-upload"]});a("#editor-btn-open").click(function(){g.DiarysManager.init()});a("#editor-btn-save").click(function(){b.doSave(true)});a("#editor-btn-create").click(function(){b.newDiary()});
a("#editor-btn-upload").click(function(){if(b.getId()=="-1"){g.Notice.showDialog("\u65e5\u8bb0\u5c1a\u672a\u88ab\u521b\u5efa, \u8bf7\u5148\u70b9\u51fb\u4fdd\u5b58!","\u53cb\u60c5\u63d0\u793a");return false}});a(".toolbar-close-btn").live("click",function(){a("#editor-toolbar").simpleTabs("hide");return false});a("#menu>li>a").tipsy({gravity:"s",fake:true})},destroy:function(){}})})(jQuery,Ediary,window);
(function(a,g){a.fn.switchTheme=function(b){function f(e,h){a("<link />").attr("type","text/css").attr("href",h).attr("id",e).attr("rel","stylesheet").attr("media","all").appendTo(a("head"))}var c={file:""};return this.each(function(){b&&a.extend(c,b);var e=this.nodeName.toLowerCase();if(e=="link"){this.disabled=true;a(this).attr("href",b.file);this.disabled=false}else if(e=="style"){f(a(this).attr("id"),b.file);a(this).remove()}})};var d={select:null,options:{element:"#toolbar-tabs-theme",previewElem:".preview-theme-btns",
changeElem:"#change-theme-btn",themeLinkElem:"#theme-css",themeRoot:g.url("/theme/"),changeThemeUrl:g.url("/user/settings/save")},init:function(){a.extend(this.options,this.extData);this.element=a(this.options.element);this.bindEvent()},bindEvent:function(){var b=this,f=this.options;a(f.previewElem).each(function(){a(this).click(function(){var c=a(this).attr("title"),e=f.themeRoot+c+"/style.css";a(f.themeLinkElem).switchTheme({file:e});b.select=c;return false})});a(f.changeElem).click(function(){null!=
b.select&&a.ajax({url:f.changeThemeUrl,data:{theme:b.select},success:function(c){c&&c.result&&g.Notice.showMessage("\u6210\u529f\u66f4\u6362\u4e3b\u9898",2E3)}})})},switchTheme:function(b){a(this.options.themeLinkElem).remove();g.loadCSS(b)},destroy:function(){}};g.ThemeManager=d})(jQuery,Ediary,window);
(function(a,g){g.extend("upload",function(){g.Upload={element:null,settings:{element:"#diary_file_upload",idElem:"#diary_id",targetElem:"#diary_file_list",deleteElem:"#diary_file_list .icon_del2_16",titleElem:"#diary_file_list>li>p",deleteUrl:"/upload/index/delete?id=",js:["/js/uploadify/swfobject.js","/js/uploadify/jquery.uploadify.v2.1.4.js","/js/fancybox/jquery.fancybox-1.3.4.js"],loadJs:true,previewSize:[160,120],uploadify:{uploader:"/js/uploadify/uploadify.swf",script:"/upload/index/images",
buttonText:"Upload",cancelImg:"/js/uploadify/cancel.png",folder:"/uploads",auto:true,multi:true,fileExt:"*.jpg;*.gif;*.png",fileDesc:"Image Files (.JPG, .GIF, .PNG)",queueID:"diary-upload-queue",wmode:"transparent"},fancybox:{titlePosition:"over",titleFormat:function(d,b,f){return'<span id="fancybox-title-over">Image '+(f+1)+" / "+b.length+" "+d+"</span>"}},fancyboxGroup:"group1"},isReady:false,init:function(d){var b=this,f=this.settings;d&&a.extend(f,d);this.element=a(f.element);f.loadJs&&this.loadJs();
this.initUploadify();a("a.lightbox",f.targetElem).fancybox(f.fancybox);a(f.deleteElem).live("click",function(){b.doDelete(a(this));return false});a(f.titleElem).live("mouseenter mouseleave",function(c){if("mouseenter"==c.type)a(this).children("a").show();else"mouseleave"==c.type&&a(this).children("a").hide()})},doDelete:function(d){var b=d.attr("href");a.getJSON(b,function(f){f&&f.status&&d.parent().parent().hide()})},loadJs:function(){if(typeof jQuery.fn.uploadify==="undefined")for(var d in this.settings.js)g.include(this.settings.js[d])},
initUploadify:function(){var d=this;this.element.uploadify(a.extend({onSelectOnce:function(){d.onSelectOnce.apply(d,arguments)},onAllComplete:function(){d.onAllComplete.apply(d,arguments)},coCancel:function(){d.onCancel.apply(d,arguments)},onComplete:function(){d.onComplete.apply(d,arguments)},onError:function(){}},this.settings.uploadify))},onSelectOnce:function(d){var b=a(this.settings.idElem).val();b!="-1"&&d.target&&a(d.target).uploadifySettings("scriptData",{diary_id:b,PHPSESSID:this.getPHPSESSION()})},
onCancel:function(){},onComplete:function(d,b,f,c){d=this.settings;if(c)try{var e=a.parseJSON(c);if(e.error){c="\u65e0\u6cd5\u4e0a\u4f20\u6587\u4ef6 ";var h=e.error;if(a.inArray("fileMimeTypeFalse",h)!=-1)c+="\u8be5\u6587\u4ef6\u7c7b\u578b\u4e0d\u88ab\u5141\u8bb8 ";if(a.inArray("fileSizeTooBig",h)!=-1)c+="\u8be5\u6587\u4ef6\u8fc7\u5927 ";g.Notice.showMessage(c,1E4)}else a("<li />").append(a("<a />",{href:e.origin,rel:d.fancyboxGroup}).fancybox(d.fancybox).append(a("<img />",{src:e.small,width:d.previewSize[0],
height:d.previewSize[1]}))).append(a("<p />").text(e.filename).append(a("<a />",{"class":"icon_del2_16",href:d.deleteUrl+e.id,html:"&nbsp"}))).appendTo(a(d.targetElem))}catch(i){a.error(i)}else g.Notice.showMessage("\u670d\u52a1\u5668\u65e0\u6cd5\u54cd\u5e94, \u8bf7\u7a0d\u540e\u518d\u8bd5.",5E3)},onAllComplete:function(){},getPHPSESSION:function(){var d=document.cookie.indexOf("PHPSESSID="),b=document.cookie.indexOf(";",d);if(b==-1)b=document.cookie.length;return document.cookie.substring(d+10,b)}}})})(jQuery,
Ediary,window);
(function(a){Ediary.extend("Validator",function(g){g.i18n.extend("Validator",{USERNAME_INVALID:"\u7528\u6237\u540d\u53ea\u80fd\u8f93\u5165\u5b57\u7b26, \u6570\u5b57\u548c\u7a7a\u683c",EMAIL_IS_NULL:"\u8bf7\u8f93\u5165\u60a8\u7684\u90ae\u7bb1\u5730\u5740",EMAIL_INVALID:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7bb1\u683c\u5f0f",EMAIL_IS_EXISTS:"\u8be5\u7535\u5b50\u90ae\u4ef6\u5df2\u7ecf\u88ab\u6ce8\u518c",PASSWORD_IS_NULL:"\u8bf7\u8f93\u5165\u60a8\u7684\u5bc6\u7801",PASSWORD_INVALID:"\u5bc6\u7801\u53ea\u5141\u8bb8\u6570\u5b57,\u5b57\u6bcd\u548c\u4e0b\u5212\u7ebf",PASSWORD_TOO_SHORT:"\u5bc6\u7801\u81f3\u5c118\u4f4d\u6570",
PASSWORD_NOT_SAME:"\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u6837"});var d=g.i18n.get("Validator");if(typeof jQuery.validator!="undefined"){jQuery.validator.addMethod("alnum",function(e,h){return this.optional(h)||/^[\w]+$/.test(e)});jQuery.validator.addMethod("regex",function(e,h,i){return this.optional(h)||i.test(e)});if(typeof g.i18n!=="undefined"){var b={rules:{email:{required:true,email:true,remote:"/user/account/exists"},password:{required:true,minlength:8},rePassword:{required:true,
equalTo:"#password"}},messages:{email:{required:d.EMAIL_IS_NULL,email:d.EMAIL_INVALID,remote:d.EMAIL_IS_EXISTS},password:{required:d.PASSWORD_IS_NULL,alnum:d.PASSWORD_INVALID,minlength:d.PASSWORD_TOO_SHORT},rePassword:{required:d.PASSWORD_IS_NULL,equalTo:d.PASSWORD_NOT_SAME}}},f={rules:{email:{required:true,email:true},password:{required:true}},messages:{email:{required:d.EMAIL_IS_NULL,email:d.EMAIL_INVALID},password:{required:d.PASSWORD_IS_NULL}}},c={form_settings:{rules:{username:{regex:/^[\w\ ]+$/},
password:{minlength:8},rePassword:{equalTo:"#password"}},messages:{password:{minlength:d.PASSWORD_TOO_SHORT},username:{regex:d.USERNAME_INVALID},rePassword:{equalTo:d.PASSWORD_NOT_SAME}}}};g.Validator={init:function(){},options:{errorElement:"span",success:function(e){e.html("Ok!").addClass("valid")}},getRegisterForm:function(){return a.extend({},this.options,b)},getLoginForm:function(){return a.extend({},this.options,f)},getFormOptions:function(e){if(c[e]!=null)return a.extend({},this.options,c[e])}}}}},
{autoLoad:false})})(jQuery,Ediary,window);
(function(a){var g={init:function(d){var b=g,f={select:0,useId:false,useCache:true,noCache:[]};return this.each(function(){d&&a.extend(f,d);var c=this,e=a(this),h=e.children("ul").children(),i=e.children("div");i.addClass("simple-tabs-panels").hide();f.select!==null&&i.eq(f.select).show().addClass("simple-tabs-select");h.children("a").each(function(j){var k=a(this).attr("href");if(k.length>1&&!/#.+/.test(k)){var l="simple-tabs-"+j,r=a("<div></div>").attr("id",l).hide().html("no content").addClass("simple-tabs-panels");
j==0||f.useId?r.insertAfter(i.last()):r.insertAfter(i.eq(j-1));a(this).attr("href","#"+l).data("url",k);k="#"+l}a(this).click(function(){var p={},m=a(this),n=a(m.attr("rev")),o=f.useId?k:j,s=m.data("url");h.children("a").removeClass("open");m.addClass("open");g.show.call(c,o);if(n.length>0)switch(n[0].nodeName.toLowerCase()){case "input":case "form":p=n.serialize();break;default:p={data:n.text()}}s&&!a(o).data("hasCache")&&a.ajax({url:s,data:p,dataType:"html",success:function(q){q=a(o).html(q);var t=
m.attr("id");f.useCache&&-1===a.inArray(t,f.noCache)&&q.data("hasCache",true)},beforeSend:function(){a(o).html("Loading...")}});return false})});a(this).data("simpleTabs",b)})},destroy:function(){return this.each(function(){})},show:function(d){a(this).children("div.simple-tabs-select").hide().remove("simple-tabs-select");typeof d==="string"&&/#.+/.test(d)?a(d).show().addClass("simple-tabs-select"):a(this).children("div").eq(d).show().addClass("simple-tabs-select")},hide:function(d){typeof d!=="undefined"?
a(this).children("div").eq(d).hide().removeClass("simple-tabs-select"):a(this).children("div").hide().removeClass("simple-tabs-select")},reset:function(d){(d=a(d).data("url"))&&a(d).data("hasCache",false)}};a.fn.simpleTabs=function(d){if(g[d])return g[d].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof d==="object"||!d)return g.init.apply(this,arguments);else a.error("Method "+d+" does not exist on jQuery.simpleTabs")}})(jQuery);
(function(a){a.fn.tipsy=function(g){g=a.extend({},a.fn.tipsy.defaults,g);return this.each(function(){var d=a.fn.tipsy.elementOptions(this,g);a(this).hover(function(){a.data(this,"cancel.tipsy",true);var b=a.data(this,"active.tipsy");if(!b){b=a('<div class="tipsy"><div class="tipsy-inner"/></div>');b.css({position:"absolute",zIndex:1E5});a.data(this,"active.tipsy",b)}if(a(this).attr("title")||typeof a(this).attr("original-title")!="string")a(this).attr("original-title",a(this).attr("title")||"").removeAttr("title");
var f;if(typeof d.title=="string")f=a(this).attr(d.title=="title"?"original-title":d.title);else if(typeof d.title=="function")f=d.title.call(this);b.find(".tipsy-inner")[d.html?"html":"text"](f||d.fallback);f=a.extend({},a(this).offset(),{width:this.offsetWidth,height:this.offsetHeight});b.get(0).className="tipsy";b.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);var c=b[0].offsetWidth,e=b[0].offsetHeight;switch((typeof d.gravity=="function"?d.gravity.call(this):
d.gravity).charAt(0)){case "n":b.css({top:f.top+f.height,left:f.left+f.width/2-c/2}).addClass("tipsy-north");break;case "s":b.css({top:f.top-e,left:f.left+f.width/2-c/2}).addClass("tipsy-south");break;case "e":b.css({top:f.top+f.height/2-e/2,left:f.left-c}).addClass("tipsy-east");break;case "w":b.css({top:f.top+f.height/2-e/2,left:f.left+f.width}).addClass("tipsy-west");break}d.fade?b.css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:0.8}):b.css({visibility:"visible"})},function(){a.data(this,
"cancel.tipsy",false);var b=this;setTimeout(function(){if(!a.data(this,"cancel.tipsy")){var f=a.data(b,"active.tipsy");if(d.fade)f.stop().fadeOut(function(){a(this).remove()});else f&&f.remove()}},100)})})};a.fn.tipsy.elementOptions=function(g,d){return a.metadata?a.extend({},d,a(g).metadata()):d};a.fn.tipsy.defaults={fade:false,fallback:"",gravity:"n",html:false,title:"title"};a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"};a.fn.tipsy.autoWE=
function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"}})(jQuery);
