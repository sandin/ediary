(function(a){function g(c){if(typeof c.data==="string"){var d=c.handler,f=c.data.toLowerCase().split(" ");c.handler=function(b){if(!(this!==b.target&&(/textarea|select/i.test(b.target.nodeName)||b.target.type==="text"))){var e=b.type!=="keypress"&&a.hotkeys.specialKeys[b.which],h=String.fromCharCode(b.which).toLowerCase(),i="",j={};if(b.altKey&&e!=="alt")i+="alt+";if(b.ctrlKey&&e!=="ctrl")i+="ctrl+";if(b.metaKey&&!b.ctrlKey&&e!=="meta")i+="meta+";if(b.shiftKey&&e!=="shift")i+="shift+";if(e)j[i+e]=
true;else{j[i+h]=true;j[i+a.hotkeys.shiftNums[h]]=true;if(i==="shift+")j[a.hotkeys.shiftNums[h]]=true}e=0;for(h=f.length;e<h;e++)if(j[f[e]])return d.apply(this,arguments)}}}}a.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",
106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};a.each(["keydown","keyup","keypress"],function(){a.event.special[this]={add:g}})})(jQuery);
if(!window.console)window.console={log:function(){},warn:function(){},error:function(){},fatal:function(){},debug:function(){},dir:function(){}};
(function(a){var g={debug:false,baseUrl:"",options:{autoLoad:true},modules:{},url:function(c){return this.baseUrl+c},extend:function(c,d,f){if(typeof this.modules[c]==="undefined"){var b=a.extend({},this.options,f);switch(typeof d){case "object":this[c]=d;break;case "function":if(b.autoLoad)this.loadModule(d,f);else this.modules[c]={origin:d,load:false};break;default:return}}},loadModule:function(c,d){var f;if(typeof c=="function")f=c;else if(typeof c=="string"){c=this.modules[c];if(typeof c!=="undefined"){f=
c.origin;c.load=true}else return}f.call(this,this,d)},include:function(c){if(!(c==null||typeof c!="string")){var d=document.createElement("script");d.type="text/javascript";d.charset="utf-8";d.src=c;a.ajaxSetup({cache:true});a("head").append(d)}},destroy:function(){}};window.Ediary=g;g.extend("i18n",function(c){c.i18n={languages:{},extend:function(d,f){if(typeof this.languages[d]=="undefined")this.languages[d]=f;return f},get:function(d){if(typeof this.languages[d]!=="undefined")return this.languages[d]}}});
g.extend("Date",function(c){c.Date={dayNames:["\u661f\u671f\u5929","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],dayNamesMin:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],monthNames:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],init:function(){},getDateAndWeek:function(d){d=
new Date;return d.getFullYear()+"\u5e74"+(d.getMonth()+1)+"\u6708"+d.getDate()+"\u65e5 "+this.dayNames[d.getDay()]}}})})(jQuery);
(function(){Ediary.extend("Events",function(a){var g=function(){this.listeners={}};g.prototype={addListener:function(d,f){if(typeof this.listeners[d]=="undefined")this.listeners[d]=[];this.listeners[d].push(f)},callListener:function(d,f){if(d=this.listeners[d])for(var b in d)d[b].handleEvent(f)},prepareArguments:function(){}};var c=function(d){this.handler=d};c.prototype={handleEvent:function(d){this.handler.apply(this,d)},makeArgs:function(){}};a.Events=g;a.Listener=c})})(jQuery,Ediary,window);
(function(a,g){var c={data:{count:10,page:1},options:{element:"#editor-btn-open",tableElem:"#table_diary_list",tbodyElem:"#table_diary_list>tbody",editBtnElem:"#table_diary_list .icon_edit_16",delBtnElem:"#table_diary_list .icon_del_16",filterElem:"#diarys_list_filter",startDateElem:"#datepicker-start",endDateElem:"#datepicker-end",boxElem:"#toolbar_extBox_list",tabsElem:"#editor-toolbar",flashElem:"#diarys_list_flash",pageElem:"#diarys_list_pages",nextPageElem:"#diarys_list_next_page",prePageElem:"#diarys_list_pre_page",
listUrl:g.url("/diary/list/get"),getUserDiaryUrl:g.url("/diary/do/user_diarys"),delUrl:g.url("/diary/do/delete")},isReady:false,init:function(){if(this.isReady)return this;this.isReady=true;a.extend(this.options,this.extData);this.element=a(this.options.element);this.bindEvent();this.flash();return this},flash:function(){this.doGetDiarys(this.data)},bindEvent:function(){var d=this,f=this.options;a(f.flashElem).click(function(){d.doGetDiarys(a.extend(d.data,{page:a(f.tableElem).data("last").current_page||
1}));return false});a(f.editBtnElem).live("click",function(){var e=d._findId(this);if(e){g.Editor.doGetDiary(e);a(f.tabsElem).simpleTabs("hide")}return false});a(f.delBtnElem).live("click",function(){var e=this;d.doDelete(d._findId(this),function(){a(e).parent().parent().hide()});return false});a(f.nextPageElem).click(function(){var e=d._nextPage();e&&d.doGetDiarys(a.extend(d.data,{page:e}));return false});a(f.prePageElem).click(function(){var e=d._nextPage(true);e&&d.doGetDiarys(a.extend(d.data,
{page:e}));return false});a(f.filterElem).click(function(){var e=a(f.startDateElem).val(),h=a(f.endDateElem).val(),i=new Date,j={page:1,count:d.data.count};if(e)j.since=e;j.max=h?h:i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate();if(j.since&&j.max&&Date.parse(j.since)>Date.parse(j.max)){g.Notice.showDialog("\u8d77\u59cb\u65e5\u671f\u4e0d\u5f97\u5927\u4e8e\u7ed3\u675f\u65e5\u671f.","\u8b66\u544a");return false}d.doGetDiarys(j);d.data=j;return false});var b={dateFormat:"yy-mm-dd",dayNamesMin:g.Date.dayNamesMin,
monthNames:g.Date.monthNames};a("#datepicker-start").datepicker(b);a("#datepicker-end").datepicker(b)},_nextPage:function(d){var f=this.options;d=d||false;if(f=a(f.tableElem).data("last"))if(d){if(f.current_page!==1)return parseInt(f.current_page)-1}else if(f.current_page*this.data.count<f.total_diarys)return parseInt(f.current_page)+1;return false},_findId:function(d){$tr=a(d).parent().parent();if($tr.length>0)return parseInt($tr.attr("id").replace("diarys_item_id_",""))},doDelete:function(d,f){a.ajax({url:this.options.delUrl,
type:"post",data:{id:d},dataType:"json",success:function(b){b&&b.result&&f();g.Notice.showMessage("\u6210\u529f",1E3)}})},doGetDiarys:function(d){var f=this,b=this.options,e=d||{count:10,page:1};a.ajax({url:b.getUserDiaryUrl,type:"post",dataType:"json",data:e,beforeSendMessage:"\u6b63\u5728\u8bf7\u6c42\u670d\u52a1\u5668",success:function(h){if(h&&h.diarys){f.updateTable(h,e);g.Notice.showMessage("\u6210\u529f",1E3);delete h.diarys;a(b.tableElem).data("last",h)}}})},updateTable:function(d,f){var b=
this.options,e=a(b.tbodyElem).empty(),h=a(b.pageElem).empty(),i=d.diarys;for(var j in i){var k=i[j],l="<td>"+k.title+"</td><td>"+k.content+"</td><td>"+k.saved_at+'</td><td><a class="icon_edit_16" href="/diary/'+k.id+'"></a><td><a class="icon_del_16" href="/diary/del/'+k.id+'"></a>';a("<tr></tr>").attr("id","diarys_item_id_"+k.id).html(l).appendTo(e)}0==i.length&&e.html("<tr><td>\u65e0\u65e5\u8bb0</td></tr>");f=d.current_page*f.count-f.count+1;h.html(f+" - "+(f+i.length-1)+" of "+d.total_diarys);this.data.since&&
a(b.startDateElem).val(this.data.since);this.data.max&&a(b.endDateElem).val(this.data.max)},getList:function(d){var f=this.options;d=d||1;a.ajax({url:f.listUrl,type:"post",dataType:"html",data:{page:d},success:function(b){a(f.boxElem).html(b);g.Notice.showMessage("\u6210\u529f",1E3)}})},destroy:function(){}};g.DiarysManager=c})(jQuery,Ediary,window);
(function(a,g,c){var d={SAVE_SUCCESS:"\u4fdd\u5b58\u6210\u529f.",SAVE_FAIL:"\u4fdd\u5b58\u5931\u8d25.",SAVING:"\u6b63\u5728\u4fdd\u5b58...",JSON_PARSE_ERROR:"\u65e0\u6cd5\u89e3\u6790\u670d\u52a1\u5668\u8fd4\u56de\u7684\u6570\u636e",NOT_SAVED:"\u65e5\u8bb0\u6ca1\u6709\u4fdd\u5b58, \u786e\u5b9a\u79bb\u5f00?",GETING_DIARYS:"\u6b63\u5728\u83b7\u53d6\u65e5\u8bb0.",SUCCESS:"\u6210\u529f"};g.i18n.extend("Editor",d);var f={TAG:"Editor -> ",AUTO_SAVE_INTERVAL:3E5,isReady:false,element:null,titleElem:null,
bodyElem:null,resizer:null,updater:null,isSaving:false,titleLength:-1,contentLength:-1,settings:{element:"#diary",formElem:"#form_diary",titleElem:"#diary_title",idElem:"#diary_id",bodyElem:"#diary_content",containerElem:".diary_container",updateElem:"#diary_last_update",ajaxSetup:{},saveUrl:Ediary.baseUrl+"/diary/do/save",getDiaryUrl:g.url("/diary/do/get"),deleteUrl:""},events:new Ediary.Events,init:function(b){var e=this;b=a.extend(this.settings,b);if(this.checkDOMIsReady()){this.element=a(b.element);
this.bodyElem=a(b.bodyElem);this.titleElem=a(b.titleElem);this.containerElem=a(b.containerElem);this.setupAjax();this.setupTinyMCE();this.updateTitleContentLength();this.cache("diary",this.getValues());this.bindEvent();if(!this.isReadonly()){this.resizer=setInterval(function(){e.resize()},500);this.startAutoSave(true)}this.isReady=true;return this}},bindEvent:function(){var b=this;this.titleElem.bind("change",function(){b.doSave(true)});a(c).bind("beforeunload",function(){b.rteSave(true);if(b.isChanged())return d.NOT_SAVED})},
updateTitleContentLength:function(){this.titleLength=this.titleElem.val().length;this.contentLength=this.bodyElem.val().length},setupTinyMCE:function(){var b=this;typeof c.tinyMCE=="undefined"&&g.include(g.baseUrl+"/js/tiny_mce/tiny_mce.js");c.tinyMCE.init({mode:"exact",elements:this.bodyElem.attr("id"),readonly:this.isReadonly()?1:0,width:this.bodyElem.width(),height:this.bodyElem.height(),plugins:"safari,paste,inlinepopups,spellchecker,insertdatetime,nonbreaking",theme:"advanced",skin:"default",
content_css:g.baseUrl+"/css/rte.css",theme_advanced_buttons1:"bold,italic,underline,|,fontselect,forecolor,|,justifyleft,justifycenter,justifyright,|,indent,outdent,|,strikethrough,backcolor,|,bullist,numlist,|,spellchecker,insertdate,link,removeformat",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"docked",theme_penzu_toolbar_location_docked_element_id:"diary_editor_toolbar_docked",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"none",
theme_advanced_resizing:true,invalid_elements:"embed,object,script,form",entity_encoding:"raw",paste_convert_middot_lists:true,paste_remove_spans:true,paste_remove_styles:true,paste_strip_class_attributes:true,nonbreaking_force_tab:true,convert_urls:false,setup:function(e){a.browser.msie&&e.onPostRender.add(function(h){if(a.browser.msie){a("iframe",a(h.getContentAreaContainer())).attr("allowTransparency","true");a(h.getBody()).css("background","transparent")}});e.onKeyPress.add(function(h){b.setDefaultContent(h)})},
template_replace_values:{},setupcontent_callback:function(e,h,i){a(i).bind("keydown","ctrl+shift+s",function(){b.doSave(true)})}})},setDefaultContent:function(b,e){b=b||this.getRTEditor();e||b.getContent().length===0?a(b.getBody()).addClass("content_is_empty"):a(b.getBody()).removeClass("content_is_empty")},checkDOMIsReady:function(){var b=this.settings,e=["element","titleElem","bodyElem","containerElem","formElem"];for(var h in e){h=e[h];if(a(b[h]).length<1)return false}return true},addListener:function(b,
e){e=new g.Listener(e);this.events.addListener(b,e)},hook:function(b,e){this.events.callListener(b,e)},callback:function(b){typeof this[b]==="function"&&this[b].call(this)},isReadonly:function(){return this.titleElem.attr("readonly")||this.bodyElem.attr("readonly")},getRTEditor:function(){var b=null;try{b=c.tinyMCE.get(this.bodyElem.attr("id"))}catch(e){}return b},repaint:function(b){b=b||this.getCache("diary");typeof b.title!=="undefined"&&this.setTitle(b.title);typeof b.content!=="undefined"&&this.setContent(b.content);
typeof b.id!=="undefined"&&this.setId(b.id);typeof b.saved_at!=="undefined"&&a(this.settings.updateElem).html(b.saved_at);this.setDefaultContent()},newDiary:function(){this.repaint({title:g.Date.getDateAndWeek(),content:"",id:"-1",saved_at:"\u672a\u4fdd\u5b58"})},getValues:function(){return{title:this.getTitle(),content:this.getContent(),id:this.getId(),saved_at:a(this.settings.updateElem).html()}},updateId:function(){this.setId(this.getCache("diary").id)},isEmpty:function(){return 0==this.titleElem.val().length||
0==this.bodyElem.val().length},isChanged:function(){return this.titleElem.val().length!==this.titleLength||this.bodyElem.val().length!==this.contentLength},startAutoSave:function(){var b=this;this.updater=setInterval(function(){b.doSave()},b.AUTO_SAVE_INTERVAL)},stopAutoSave:function(){if(this.updater){clearInterval(this.updater);this.updater=null}},resize:function(){var b=this.getRTEditor(),e,h,i,j,k={minHeight:815,increment:815,margin:0};if(b){e=a("iframe",a(b.getContentAreaContainer()));h=e.height();
i=a.browser.chrome?a(b.getBody()).insideHeight():a(b.getBody()).height();k.margin=40}else if(!this.isReadonly()){e=this.bodyElem;h=e.height();i=e.get(0).scrollHeight}if(e){if(h<i+k.margin||h-k.increment>i+k.margin)j=Math.ceil((i+k.margin)/k.increment)*k.increment;if(j){j=Math.max(k.minHeight,j);e.css("height",j+"px");this.containerElem.css("height",j+"px")}}},stopResizer:function(){if(this.resizer){clearInterval(this.resizer);this.resizer=null}},rteSave:function(b){b=b||false;var e=this.getRTEditor();
if(b||e&&e.isDirty())e.save()},doSave:function(b){try{var e=this;b=b||false;var h=a(this.settings.formElem);this.rteSave();if(!(!b&&(this.isEmpty()||this.isSaving)))if(b||this.isChanged())a.ajax({url:e.settings.saveUrl,type:"POST",data:h.serialize(),dataType:"json",beforeSend:function(){e.isSaving=true;g.Notice.showMessage(d.SAVING);e.updateStatus(false);e.hook("onBeforeSend",arguments)},success:function(j){e.isSaving=false;e.onSaveDone(j);e.updateStatus(true);e.hook("onSaveDone",arguments)}})}catch(i){}},
onSaveDone:function(b){var e=d.SAVE_FAIL;if(this.checkData(b)&&b.diary){this.repaint({saved_at:b.diary.saved_at});this.updateTitleContentLength();e=d.SAVE_SUCCESS}g.Notice.showMessage(e,3E3)},updateStatus:function(b){b=b||false;var e=a(this.settings.updateElem).prev();if(b){e.removeClass("icon_loading_16");e.addClass("icon_ok_16")}else{e.removeClass("icon_ok_16");e.addClass("icon_loading_16")}},checkData:function(b){if(null==b)return false;if(b.error){g.Notice.showMessage(b.error);return false}b.diary&&
this.cache("diary",b.diary);b.callback&&this.callback(b.callback);return true},doGetDiary:function(b){var e=this;a.ajax({url:e.settings.getDiaryUrl,data:{id:b},type:"POST",dataType:"json",beforeSendMessage:d.GET_DIARYS,success:function(h){e.onGetDiaryDone(h);e.hook("onGetDiaryDone",arguments)}})},onGetDiaryDone:function(b){if(this.checkData(b))if(b.diary){this.repaint();g.Notice.showMessage(d.SUCCESS,1E3)}},doDelete:function(){},setupAjax:function(){var b=this;a.extend(this.settings.ajaxSetup,{error:function(e,
h){"parsererror"==h&&g.Notice.showMessage(d.JSON_PARSE_ERROR);b.hook("onError",arguments)},beforeSend:function(e,h){var i=h.beforeSendMessage;i&&g.Notice.showMessage(i);b.hook("onBeforeSend",arguments)}});a.ajaxSetup(this.settings.ajaxSetup)},cache:function(b,e){this.element.data(b,e)},getCache:function(b){return this.element.data(b)},setTitle:function(b){this.titleElem.val(b)},getTitle:function(){return this.titleElem.val()},setContent:function(b){this.getRTEditor()?this.getRTEditor().setContent(b):
this.bodyElem.val(b)},getContent:function(){return this.getRTEditor()?this.getRTEditor().getContent():this.bodyElem.val()},setId:function(b){a(this.settings.idElem).val(b)},getId:function(){return a(this.settings.idElem).val()},destroy:function(){this.stopAutoSave();this.stopResizer();this.getRTEditor();this.bodyElem=this.titleElem=this.element=null}};g.extend("Editor",f)})(jQuery,Ediary,window);
(function(a){Ediary.extend("Notice",{element:null,isReady:false,options:{element:"#notice",dialogElem:"#dialog-message"},dialog:null,timer:null,init:function(g){if(!this.isReady){a.extend(this.options,g);this.element=a(this.options.element);if(this.element.length!=0){this.isReady=true;return this}}},showMessage:function(g,c){this.isReady||this.init();this._setMessage(g);typeof c!=="undefined"&&this._hide(c)},getMessage:function(){if(this.element)return this.element.html()},showDialog:function(g,c){var d=
this.options;c=c||"\u63d0\u793a\u6846";if(!this.dialog){this.dialog=a(d.dialogElem);if(this.dialog.length==0)this.dialog=a("<div></div>").attr("id",d.dialogElem.slice(1)).attr("title",c).appendTo(a("body"));this.dialog.dialog({modal:true,buttons:{Ok:function(){a(this).dialog("close")}}})}this.dialog.attr("title",c).text(g).dialog("open")},_setMessage:function(g){this.timer&&clearTimeout(this.timer);this.element.show();this.element.html(g)},_resetMessage:function(){this._setMessage("")},_hide:function(g){var c=
this;this.timer=setTimeout(function(){c._resetMessage();c.element.hide()},g)},destroy:function(){this._resetMessage();this.element=null}})})(jQuery,Ediary,window);
(function(a,g){g.extend("Pad",{options:{editor:{},notice:{}},init:function(c){this.initEditor(c);return this},initEditor:function(c){a.extend(this.options,c);var d=g.Editor.init(this.options.editor);d.addListener("onSaveSuccess",function(){});a("#editor-toolbar").simpleTabs({select:null,useId:true,cache:true,noCache:["editor-btn-upload"]});a("#editor-btn-open").click(function(){g.DiarysManager.init()});a("#editor-btn-save").click(function(){d.doSave(true)});a("#editor-btn-create").click(function(){d.newDiary()});
a("#editor-btn-upload").click(function(){if(d.getId()=="-1"){d.setContent("&nbsp;");d.doSave(true);return false}});a(".toolbar-close-btn").live("click",function(){a("#editor-toolbar").simpleTabs("hide");return false});a("#menu>li>a").tipsy({gravity:"s",fake:true})},destroy:function(){}})})(jQuery,Ediary,window);
(function(a,g){var c={select:null,options:{element:"#toolbar-tabs-theme",previewElem:".preview-theme-btns",changeElem:"#change-theme-btn",themeLinkElem:"#theme-css",themeRoot:g.url("/theme/"),changeThemeUrl:g.url("/user/settings/save")},init:function(){a.extend(this.options,this.extData);this.element=a(this.options.element);this.bindEvent()},bindEvent:function(){var d=this,f=this.options;a(f.previewElem).each(function(){a(this).click(function(){var b=a(this).attr("href"),e=f.themeRoot+b+"/style.css";
a(f.themeLinkElem).attr("href",e);d.select=b;return false})});a(f.changeElem).click(function(){null!=d.select&&a.ajax({url:f.changeThemeUrl,data:{theme:d.select},success:function(b){b&&b.result&&g.Notice.showMessage("\u6210\u529f\u66f4\u6362\u4e3b\u9898",2E3)}})})},destroy:function(){}};g.ThemeManager=c})(jQuery,Ediary,window);
(function(a,g){g.extend("upload",function(){g.Upload={element:null,settings:{element:"#diary_file_upload",idElem:"#diary_id",targetElem:"#diary_file_list",deleteElem:"#diary_file_list .delete",titleElem:"#diary_file_list>li>p",deleteUrl:"/upload/index/delete?id=",js:["/js/uploadify/swfobject.js","/js/uploadify/jquery.uploadify.v2.1.4.js","/js/fancybox/jquery.fancybox-1.3.4.js"],loadJs:true,previewSize:[160,120],uploadify:{uploader:"/js/uploadify/uploadify.swf",script:"/upload/index/images",buttonText:"Upload",
cancelImg:"/js/uploadify/cancel.png",folder:"/uploads",auto:true,multi:true,fileExt:"*.jpg;*.gif;*.png",fileDesc:"Image Files (.JPG, .GIF, .PNG)",queueID:"diary-upload-queue",wmode:"transparent"},fancybox:{titlePosition:"over",titleFormat:function(c,d,f){return'<span id="fancybox-title-over">Image '+(f+1)+" / "+d.length+" "+c+"</span>"}},fancyboxGroup:"group1"},isReady:false,init:function(c){var d=this,f=this.settings;c&&a.extend(f,c);this.element=a(f.element);f.loadJs&&this.loadJs();this.initUploadify();
a("a.lightbox",f.targetElem).fancybox(f.fancybox);a(f.deleteElem).live("click",function(){d.doDelete(a(this));return false});a(f.titleElem).live("mouseenter mouseleave",function(b){if("mouseenter"==b.type)a(this).children("a").show();else"mouseleave"==b.type&&a(this).children("a").hide()})},doDelete:function(c){var d=c.attr("href");a.getJSON(d,function(f){f&&f.status&&c.parent().parent().hide()})},loadJs:function(){if(typeof jQuery.fn.uploadify==="undefined")for(var c in this.settings.js)g.include(this.settings.js[c])},
initUploadify:function(){var c=this;this.element.uploadify(a.extend({onSelectOnce:function(){c.onSelectOnce.apply(c,arguments)},onAllComplete:function(){c.onAllComplete.apply(c,arguments)},coCancel:function(){c.onCancel.apply(c,arguments)},onComplete:function(){c.onComplete.apply(c,arguments)},onError:function(d,f,b,e){a.error(e)}},this.settings.uploadify))},onSelectOnce:function(c){var d=a(this.settings.idElem).val();d!="-1"&&a(c.target).uploadifySettings("scriptData",{diary_id:d})},onCancel:function(){},
onComplete:function(c,d,f,b){c=this.settings;if(b)try{var e=a.parseJSON(b);if(e.error){b="\u65e0\u6cd5\u4e0a\u4f20\u6587\u4ef6 ";var h=e.error;if(a.inArray("fileMimeTypeFalse",h)!=-1)b+="\u8be5\u6587\u4ef6\u7c7b\u578b\u4e0d\u88ab\u5141\u8bb8 ";if(a.inArray("fileSizeTooBig",h)!=-1)b+="\u8be5\u6587\u4ef6\u8fc7\u5927 ";g.Notice.showMessage(b,1E4)}else a("<li />").append(a("<a />",{href:e.origin,rel:c.fancyboxGroup}).fancybox(c.fancybox).append(a("<img />",{src:e.small,width:c.previewSize[0],height:c.previewSize[1]}))).append(a("<p />").text(e.filename).append(a("<a />",
{"class":"delete",href:c.deleteUrl+e.id,html:"&nbsp"}))).appendTo(a(c.targetElem))}catch(i){a.error(i)}else g.Notice.showMessage("\u670d\u52a1\u5668\u65e0\u6cd5\u54cd\u5e94, \u8bf7\u7a0d\u540e\u518d\u8bd5.",5E3)},onAllComplete:function(){}}})})(jQuery,Ediary,window);
(function(a){Ediary.extend("Validator",function(g){g.i18n.extend("Validator",{USERNAME_INVALID:"\u7528\u6237\u540d\u53ea\u80fd\u8f93\u5165\u5b57\u7b26, \u6570\u5b57\u548c\u7a7a\u683c",EMAIL_IS_NULL:"\u8bf7\u8f93\u5165\u60a8\u7684\u90ae\u7bb1\u5730\u5740",EMAIL_INVALID:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7bb1\u683c\u5f0f",EMAIL_IS_EXISTS:"\u8be5\u7535\u5b50\u90ae\u4ef6\u5df2\u7ecf\u88ab\u6ce8\u518c",PASSWORD_IS_NULL:"\u8bf7\u8f93\u5165\u60a8\u7684\u5bc6\u7801",PASSWORD_INVALID:"\u5bc6\u7801\u53ea\u5141\u8bb8\u6570\u5b57,\u5b57\u6bcd\u548c\u4e0b\u5212\u7ebf",
PASSWORD_TOO_SHORT:"\u5bc6\u7801\u81f3\u5c118\u4f4d\u6570",PASSWORD_NOT_SAME:"\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u4e0d\u4e00\u6837"});var c=g.i18n.get("Validator");if(typeof jQuery.validator!="undefined"){jQuery.validator.addMethod("alnum",function(e,h){return this.optional(h)||/^[\w]+$/.test(e)});jQuery.validator.addMethod("regex",function(e,h,i){return this.optional(h)||i.test(e)});if(typeof g.i18n!=="undefined"){var d={rules:{email:{required:true,email:true,remote:"/user/account/exists"},
password:{required:true,minlength:8},rePassword:{required:true,equalTo:"#password"}},messages:{email:{required:c.EMAIL_IS_NULL,email:c.EMAIL_INVALID,remote:c.EMAIL_IS_EXISTS},password:{required:c.PASSWORD_IS_NULL,alnum:c.PASSWORD_INVALID,minlength:c.PASSWORD_TOO_SHORT},rePassword:{required:c.PASSWORD_IS_NULL,equalTo:c.PASSWORD_NOT_SAME}}},f={rules:{email:{required:true,email:true},password:{required:true}},messages:{email:{required:c.EMAIL_IS_NULL,email:c.EMAIL_INVALID},password:{required:c.PASSWORD_IS_NULL}}},
b={form_settings:{rules:{username:{regex:/^[\w\ ]+$/},password:{minlength:8},rePassword:{equalTo:"#password"}},messages:{password:{minlength:c.PASSWORD_TOO_SHORT},username:{regex:c.USERNAME_INVALID},rePassword:{equalTo:c.PASSWORD_NOT_SAME}}}};g.Validator={init:function(){},options:{errorElement:"span",success:function(e){e.html("Ok!").addClass("valid")}},getRegisterForm:function(){return a.extend({},this.options,d)},getLoginForm:function(){return a.extend({},this.options,f)},getFormOptions:function(e){if(b[e]!=
null)return a.extend({},this.options,b[e])}}}}},{autoLoad:false})})(jQuery,Ediary,window);
(function(a){var g={init:function(c){var d=g,f={select:0,useId:false,useCache:true,noCache:[]};return this.each(function(){c&&a.extend(f,c);var b=this,e=a(this),h=e.children("ul").children(),i=e.children("div");i.addClass("simple-tabs-panels").hide();f.select!==null&&i.eq(f.select).show().addClass("simple-tabs-select");h.children("a").each(function(j){var k=a(this).attr("href");if(k.length>1&&!/#.+/.test(k)){var l="simple-tabs-"+j,r=a("<div></div>").attr("id",l).hide().html("no content").addClass("simple-tabs-panels");
j==0||f.useId?r.insertAfter(i.last()):r.insertAfter(i.eq(j-1));a(this).attr("href","#"+l).data("url",k);k="#"+l}a(this).click(function(){var p={},m=a(this),n=a(m.attr("rev")),o=f.useId?k:j,s=m.data("url");h.children("a").removeClass("open");m.addClass("open");g.show.call(b,o);if(n.length>0)switch(n[0].nodeName.toLowerCase()){case "input":case "form":p=n.serialize();break;default:p={data:n.text()}}s&&!a(o).data("hasCache")&&a.ajax({url:s,data:p,dataType:"html",success:function(q){q=a(o).html(q);var t=
m.attr("id");f.useCache&&-1===a.inArray(t,f.noCache)&&q.data("hasCache",true)},beforeSend:function(){a(o).html("Loading...")}});return false})});a(this).data("simpleTabs",d)})},destroy:function(){return this.each(function(){})},show:function(c){a(this).children("div.simple-tabs-select").hide().remove("simple-tabs-select");typeof c==="string"&&/#.+/.test(c)?a(c).show().addClass("simple-tabs-select"):a(this).children("div").eq(c).show().addClass("simple-tabs-select")},hide:function(c){typeof c!=="undefined"?
a(this).children("div").eq(c).hide().removeClass("simple-tabs-select"):a(this).children("div").hide().removeClass("simple-tabs-select")},reset:function(c){(c=a(c).data("url"))&&a(c).data("hasCache",false)}};a.fn.simpleTabs=function(c){if(g[c])return g[c].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof c==="object"||!c)return g.init.apply(this,arguments);else a.error("Method "+c+" does not exist on jQuery.simpleTabs")}})(jQuery);
(function(a){a.fn.tipsy=function(g){g=a.extend({},a.fn.tipsy.defaults,g);return this.each(function(){var c=a.fn.tipsy.elementOptions(this,g);a(this).hover(function(){a.data(this,"cancel.tipsy",true);var d=a.data(this,"active.tipsy");if(!d){d=a('<div class="tipsy"><div class="tipsy-inner"/></div>');d.css({position:"absolute",zIndex:1E5});a.data(this,"active.tipsy",d)}if(a(this).attr("title")||typeof a(this).attr("original-title")!="string")a(this).attr("original-title",a(this).attr("title")||"").removeAttr("title");
var f;if(typeof c.title=="string")f=a(this).attr(c.title=="title"?"original-title":c.title);else if(typeof c.title=="function")f=c.title.call(this);d.find(".tipsy-inner")[c.html?"html":"text"](f||c.fallback);f=a.extend({},a(this).offset(),{width:this.offsetWidth,height:this.offsetHeight});d.get(0).className="tipsy";d.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);var b=d[0].offsetWidth,e=d[0].offsetHeight;switch((typeof c.gravity=="function"?c.gravity.call(this):
c.gravity).charAt(0)){case "n":d.css({top:f.top+f.height,left:f.left+f.width/2-b/2}).addClass("tipsy-north");break;case "s":d.css({top:f.top-e,left:f.left+f.width/2-b/2}).addClass("tipsy-south");break;case "e":d.css({top:f.top+f.height/2-e/2,left:f.left-b}).addClass("tipsy-east");break;case "w":d.css({top:f.top+f.height/2-e/2,left:f.left+f.width}).addClass("tipsy-west");break}c.fade?d.css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:0.8}):d.css({visibility:"visible"})},function(){a.data(this,
"cancel.tipsy",false);var d=this;setTimeout(function(){if(!a.data(this,"cancel.tipsy")){var f=a.data(d,"active.tipsy");if(c.fade)f.stop().fadeOut(function(){a(this).remove()});else f&&f.remove()}},100)})})};a.fn.tipsy.elementOptions=function(g,c){return a.metadata?a.extend({},c,a(g).metadata()):c};a.fn.tipsy.defaults={fade:false,fallback:"",gravity:"n",html:false,title:"title"};a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"};a.fn.tipsy.autoWE=
function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"}})(jQuery);
