<?php
require_once 'PHPUnit/Framework.php';

/**
 * Test class for Ediary_Db.
 * Generated by PHPUnit on 2011-02-23 at 16:38:18.
 */
class Ediary_Ddatabase_SchemaTest extends ControllerTestCase
{
    /**
     * @var Ediary_Database_Schema
     */
    protected $object;
    
    /**
     * @var Zend_Db_Adapter_Abstract 
     */
    private $db;

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    public function setUp()
    {
        parent::setUp();
         
        $this->db = Ediary_Db::getInstance();
        $this->object = new Ediary_Database_Schema($this->db);
        
        // DEBUG: THIS WILL DROP TABLES AND RECREATE THEM
        //Ediary_Db::getInstance()->upgrade();
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {
    }
    
    public function testCreateTable() {
        $obj = $this->object;
        $tableName = 'testTable';
        $this->assertTrue($obj->createTable($tableName, "create table testTable(name int)"));
        $this->db->getConnection()->getConnection()->exec(
        	"DROP TABLE IF EXISTS " . Ediary_Db::prefix($tableName));
    }
    
    /**
     * @deprecated 该测试会删除并创建所有表, 只应在测试环境进行
    public function testCreateTables() {
        $obj = $this->object;
        $this->assertTrue($obj->createTables());
        
        $sql = $obj->getCreateSql();
        $this->assertNotNull($sql);
        //var_dump($sql);
    }
     */


}